<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Laboratory â€” Calculator (Detailed)</title>
  <meta name="description" content="Click-first scientific calculator and unit converter for The Laboratory." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0e0f12; --panel:#121418; --panel-2:#15181d; --ink:#e7e9ed; --muted:#8c96a3; --line:rgba(255,255,255,.08);
      --accent:#e6b422; --accent-2:#6ee7b7; --danger:#ef4444; --card:#14171c; --shadow:0 10px 30px rgba(0,0,0,.35);
      --r-lg:16px; --btn:#1a1f27; --btn-hover:#202633; --btn-ops:#2a2f3a; --btn-eq:#374151;
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --panel:#ffffff; --panel-2:#eef1f6; --ink:#0f141a; --muted:#5b6574; --line:rgba(0,0,0,.08);
      --accent:#b08900; --accent-2:#118f6b; --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.08);
      --btn:#eef1f6; --btn-hover:#e4e8ef; --btn-ops:#e9edf4; --btn-eq:#e6e9f0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--ink)}
    header{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 16px; background:var(--panel-2); border-bottom:1px solid var(--line); position:sticky; top:0; z-index:5}
    .brand{display:flex; gap:10px; align-items:center}
    .mark{width:36px; height:36px; border-radius:10px; background:conic-gradient(from 180deg,#20242b,#1a1f27,#2a2f38); border:1px solid var(--line); position:relative}
    .mark:after{content:""; position:absolute; inset:7px; border-radius:6px; border:2px solid var(--accent); transform:rotate(8deg); opacity:.85}
    .btn{border:1px solid var(--line); background:var(--panel); color:var(--ink); border-radius:10px; padding:8px 12px; font-weight:600; cursor:pointer; transition:.18s; text-decoration:none; display:inline-flex; align-items:center; gap:8px}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0)} .btn.primary{border-color:rgba(230,180,34,.35); box-shadow:var(--shadow)} .btn.ghost{background:transparent}

    .wrap{max-width:1200px; margin:16px auto; padding:0 16px; display:grid; gap:12px; grid-template-columns: 1.1fr 1fr}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--r-lg); padding:16px; box-shadow:var(--shadow)}
    h2{margin:0 0 8px 0}

    /* Tabs */
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
    .tab{padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:var(--panel); cursor:pointer; font-weight:700}
    .tab.active{border-color:rgba(230,180,34,.35); box-shadow:var(--shadow)}

    /* Calculator */
    .display{background:rgba(255,255,255,.03); border:1px solid var(--line); border-radius:12px; padding:12px; font-family:ui-monospace,Consolas,monospace}
    .expr{font-size:14px; color:var(--muted); min-height:20px; word-wrap:anywhere}
    .value{font-size:32px; font-weight:800; text-align:right}
    .toggles{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .seg{display:inline-flex; border:1px solid var(--line); border-radius:999px; overflow:hidden}
    .seg button{background:var(--panel); padding:6px 10px; border:none; color:var(--ink)}
    .seg button.active{background:var(--accent-2); color:#0a0f12; font-weight:800}
    .keypad{display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; margin-top:10px}
    .k{border:1px solid var(--line); background:var(--btn); border-radius:12px; padding:12px; text-align:center; font-weight:800; cursor:pointer; user-select:none}
    .k:hover{background:var(--btn-hover)} .k.op{background:var(--btn-ops)} .k.eq{background:var(--btn-eq)} .k.wide{grid-column: span 2} .k.tall{grid-row: span 2}

    /* Right: constants + history */
    .list{display:grid; gap:8px}
    .result{font-family:ui-monospace,Consolas,monospace; background:rgba(255,255,255,.03); border:1px dashed var(--line); border-radius:10px; padding:8px 10px; white-space:pre-wrap}
    .hist{max-height:260px; overflow:auto}

    /* Converter */
    .conv-grid{display:grid; gap:8px; grid-template-columns: repeat(2,1fr)}
    .conv-grid select, .conv-grid input{background:var(--panel); color:var(--ink); border:1px solid var(--line); border-radius:10px; padding:10px 12px}
    .full{grid-column:1 / -1}

    .small{font-size:12px; color:var(--muted)}
  </style>
</head>
<body data-theme="dark">
  <header>
    <div class="brand">
      <div class="mark" aria-hidden="true"></div>
      <h1 style="margin:0; font-size:16px; letter-spacing:.12em; text-transform:uppercase; font-weight:800">The Laboratory â€” Calculator</h1>
    </div>
    <div class="row">
      <button class="btn ghost" id="theme">ðŸŒ— Theme</button>
      <a class="btn" href="laboratory.html">â†© Return to Index</a>
    </div>
  </header>

  <div class="wrap">
    <!-- Left: Calculator -->
    <section class="card">
      <div class="tabs">
        <button class="tab active" data-tab="calc">Calculator</button>
        <button class="tab" data-tab="convert">Unit Converter</button>
        <button class="tab" data-tab="massvol">Mass â‡„ Volume (by density)</button>
        <button class="tab" data-tab="constants">Constants</button>
      </div>

      <!-- CALC PANEL -->
      <div id="panel-calc">
        <div class="display">
          <div class="expr" id="exprShow">0</div>
          <div class="value" id="valShow">0</div>
        </div>
        <div class="toggles">
          <div class="seg" aria-label="Angle Mode">
            <button class="active" id="degBtn">Deg</button>
            <button id="radBtn">Rad</button>
          </div>
          <div class="seg" aria-label="Inverse">
            <button class="active" id="normBtn">Norm</button>
            <button id="invBtn">INV</button>
          </div>
          <span class="small">Tip: Use Ans, Ï€, e, c (light), gâ‚€, h, kB, NA</span>
        </div>
        <div class="keypad" id="pad">
          <!-- row 1 -->
          <div class="k op" data-act="ac">AC</div>
          <div class="k op" data-act="back">âŒ«</div>
          <div class="k op" data-ins="(">(</div>
          <div class="k op" data-ins=")">)</div>
          <div class="k op" data-ins=",">,</div>
          <div class="k op" data-ins="/">Ã·</div>
          <!-- row 2 -->
          <div class="k" data-ins="7">7</div>
          <div class="k" data-ins="8">8</div>
          <div class="k" data-ins="9">9</div>
          <div class="k op" data-ins="*">Ã—</div>
          <div class="k op" data-ins="^">xÊ¸</div>
          <div class="k op" data-fn="sqrt">âˆš</div>
          <!-- row 3 -->
          <div class="k" data-ins="4">4</div>
          <div class="k" data-ins="5">5</div>
          <div class="k" data-ins="6">6</div>
          <div class="k op" data-ins="-">âˆ’</div>
          <div class="k op" data-fn="log10">log</div>
          <div class="k op" data-fn="ln">ln</div>
          <!-- row 4 -->
          <div class="k" data-ins="1">1</div>
          <div class="k" data-ins="2">2</div>
          <div class="k" data-ins="3">3</div>
          <div class="k op" data-ins="+">+</div>
          <div class="k op" data-fn="sin">sin</div>
          <div class="k op" data-fn="cos">cos</div>
          <!-- row 5 -->
          <div class="k wide" data-ins="0">0</div>
          <div class="k" data-ins=".">.</div>
          <div class="k op" data-fn="tan">tan</div>
          <div class="k eq tall" data-act="eval">=</div>
          <!-- row 6 -->
          <div class="k op" data-const="pi">Ï€</div>
          <div class="k op" data-const="e">e</div>
          <div class="k op" data-const="c">c</div>
          <div class="k op" data-const="g0">gâ‚€</div>
          <div class="k op" data-const="h">h</div>
          <div class="k op" data-const="kB">kB</div>
          <!-- row 7 -->
          <div class="k op" data-const="NA">NA</div>
          <div class="k op" data-act="ans">Ans</div>
          <div class="k op" data-act="percent">%</div>
          <div class="k op" data-fn="abs">abs</div>
          <div class="k op" data-fn="exp">exp</div>
          <div class="k op" data-fn="fact">n!</div>
        </div>
      </div>

      <!-- CONVERTER PANEL -->
      <div id="panel-convert" style="display:none">
        <div class="conv-grid">
          <select id="cat"></select>
          <input id="fromVal" type="number" step="any" value="1" />
          <select id="fromUnit"></select>
          <select id="toUnit"></select>
          <button class="btn full" id="doConv">Convert</button>
          <div class="result full" id="convOut">â€”</div>
        </div>
        <p class="small" style="margin-top:8px">Covers: Length, Area, Volume (incl. kitchen + US), Mass (incl. kati/catty, tahil, picul), Time, Speed (incl. c), Acceleration, Temperature, Energy, Power, Pressure, Data, Angle, Force, Frequency, Density. Case-sensitive unit labels shown in menus.</p>
      </div>

      <!-- MASS-VOLUME PANEL (by density) -->
      <div id="panel-massvol" style="display:none">
        <div class="conv-grid">
          <select id="mvDirection" class="full">
            <option value="m2v">Mass â†’ Volume</option>
            <option value="v2m">Volume â†’ Mass</option>
          </select>
          <input id="mvValue" type="number" step="any" value="1" />
          <select id="mvFrom"></select>
          <select id="mvTo"></select>
          <input id="mvDensity" type="number" step="any" value="1000" />
          <select id="mvDensityUnit">
            <option>kg/mÂ³</option>
            <option>g/cmÂ³</option>
            <option>g/mL</option>
          </select>
          <button class="btn full" id="doMV">Convert by density</button>
          <div class="result full" id="mvOut">Uses density to convert massâ†”volume. Defaults to water (1000 kg/mÂ³).</div>
        </div>
        <div class="tabs" style="margin-top:8px">
          <button class="tab" data-d="1000">Water</button>
          <button class="tab" data-d="13534">Mercury</button>
          <button class="tab" data-d="789">Ethanol</button>
          <button class="tab" data-d="920">Vegetable Oil</button>
        </div>
      </div>

      <!-- CONSTANTS PANEL -->
      <div id="panel-constants" style="display:none">
        <div class="list">
          <div class="result">c (speed of light) = 299792458 m/s</div>
          <div class="result">gâ‚€ (standard gravity) = 9.80665 m/sÂ²</div>
          <div class="result">Ï€ = 3.141592653589793</div>
          <div class="result">e = 2.718281828459045</div>
          <div class="result">Ï„ = 6.283185307179586</div>
          <div class="result">h (Planck) = 6.62607015e-34 JÂ·s</div>
          <div class="result">kB (Boltzmann) = 1.380649e-23 J/K</div>
          <div class="result">NA (Avogadro) = 6.02214076e23</div>
        </div>
      </div>
    </section>

    <!-- Right: History -->
    <aside class="card">
      <h2>History</h2>
      <div id="hist" class="list hist"><div class="small">No calculations yet.</div></div>
    </aside>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    // Theme
    const saved = localStorage.getItem('labTheme');
    if(saved) document.body.setAttribute('data-theme', saved);
    document.getElementById('theme').addEventListener('click', ()=>{
      const curr = document.body.getAttribute('data-theme')||'dark';
      const next = curr==='dark'?'light':'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('labTheme', next);
    });

    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const panels = {
      calc: document.getElementById('panel-calc'),
      convert: document.getElementById('panel-convert'),
      massvol: document.getElementById('panel-massvol'),
      constants: document.getElementById('panel-constants')
    };
    tabs.forEach(t=>t.addEventListener('click',()=>{
      tabs.forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const id = t.dataset.tab || (t.closest('#panel-massvol')? 'massvol' : 'calc');
      Object.values(panels).forEach(p=>p.style.display='none');
      panels[id].style.display='block';
    }));

    // ===== Calculator =====
    const exprShow = document.getElementById('exprShow');
    const valShow = document.getElementById('valShow');
    const histEl = document.getElementById('hist');
    let expr = '';
    let angleMode = 'deg';
    let inv = false;
    let lastAnswer = 0;

    const CONST = { pi: Math.PI, e: Math.E, c: 299792458, g0: 9.80665, h: 6.62607015e-34, kB: 1.380649e-23, NA: 6.02214076e23, Ï„: Math.PI*2 };
    const FN = {
      sin:x=>Math.sin(angleMode==='deg'?x*Math.PI/180:x),
      cos:x=>Math.cos(angleMode==='deg'?x*Math.PI/180:x),
      tan:x=>Math.tan(angleMode==='deg'?x*Math.PI/180:x),
      asin:x=>(Math.asin(x)*(angleMode==='deg'?180/Math.PI:1)),
      acos:x=>(Math.acos(x)*(angleMode==='deg'?180/Math.PI:1)),
      atan:x=>(Math.atan(x)*(angleMode==='deg'?180/Math.PI:1)),
      log10: x=>Math.log10(x), ln: Math.log, exp: Math.exp,
      sqrt: Math.sqrt, abs: Math.abs,
      fact: n=>{ n=Math.floor(n); if(n<0||n>170) return NaN; let a=1; for(let i=2;i<=n;i++) a*=i; return a; }
    };

    function render(){ exprShow.textContent = expr || '0'; }
    function append(text){ expr += text; render(); }
    function insertFn(name){
      if(inv){
        const map = {sin:'asin', cos:'acos', tan:'atan', log10:'exp', ln:'exp'};
        append((map[name]||name) + '(');
      } else {
        append(name + '(');
      }
    }

    document.getElementById('degBtn').addEventListener('click',()=>{ angleMode='deg'; toggle('degBtn','radBtn'); });
    document.getElementById('radBtn').addEventListener('click',()=>{ angleMode='rad'; toggle('radBtn','degBtn'); });
    document.getElementById('normBtn').addEventListener('click',()=>{ inv=false; toggle('normBtn','invBtn'); });
    document.getElementById('invBtn').addEventListener('click',()=>{ inv=true; toggle('invBtn','normBtn'); });
    function toggle(on,off){ document.getElementById(on).classList.add('active'); document.getElementById(off).classList.remove('active'); }

    document.getElementById('pad').addEventListener('click',(e)=>{
      const k = e.target.closest('.k'); if(!k) return;
      if(k.dataset.ins){ append(k.dataset.ins); return; }
      if(k.dataset.fn){ insertFn(k.dataset.fn); return; }
      if(k.dataset.const){ append(k.dataset.const); return; }
      if(k.dataset.act){
        const a = k.dataset.act;
        if(a==='ac'){ expr=''; valShow.textContent='0'; render(); return; }
        if(a==='back'){ expr=expr.slice(0,-1); render(); return; }
        if(a==='eval'){ doEval(); return; }
        if(a==='ans'){ append('Ans'); return; }
        if(a==='percent'){ append('/100'); return; }
      }
    });

    function doEval(){
      try{
        const js = toJS(expr);
        const scope = { ...CONST, ...FN, Ans: lastAnswer, pi: CONST.pi };
        const args = Object.keys(scope); const vals = Object.values(scope);
        const f = new Function(...args, '"use strict"; return ('+js+');');
        const result = f(...vals);
        lastAnswer = result;
        valShow.textContent = String(result);
        pushHist(expr + ' = ' + result);
      }catch(err){ valShow.textContent = 'Error'; console.error(err); }
    }

    function toJS(s){
      if(!s) return '0';
      s = s.replace(/Ï€/g,'pi').replace(/Ï„/g,'tau');
      s = s.replace(/\^/g,'**').replace(/Ã—/g,'*').replace(/Ã·/g,'/');
      if(/[^0-9+\-*/%^()., A-Za-z_]/.test(s)) throw new Error('Bad token');
      return s;
    }

    function pushHist(line){
      const div = document.createElement('div'); div.className='result'; div.textContent=line;
      div.addEventListener('click',()=>{ expr = line.split(' = ')[0]; render(); });
      if(histEl.textContent.includes('No calculations yet.')) histEl.innerHTML='';
      histEl.prepend(div);
    }

    // ===== Converter =====
    const UNITS = {
      Length: { base:'m', units:{
        'nm':1e-9,'Î¼m':1e-6,'mm':1e-3,'cm':1e-2,'m':1,'km':1e3,
        'inch':0.0254,'ft':0.3048,'yd':0.9144,'mile':1609.344,'nmi':1852,
        'au':149597870700,'ly':9.4607304725808e15,'pc':3.085677581491367e16
      }},
      Area: { base:'mÂ²', units:{
        'mmÂ²':1e-6,'cmÂ²':1e-4,'mÂ²':1,'kmÂ²':1e6,'are':100,'ha':1e4,
        'inÂ²':0.00064516,'ftÂ²':0.09290304,'ydÂ²':0.83612736,'acre':4046.8564224
      }},
      Volume: { base:'mÂ³', units:{
        'mmÂ³':1e-9,'cmÂ³':1e-6,'mL':1e-6,'L':1e-3,'mÂ³':1,
        'tsp':4.92892159375e-6,'tbsp':1.478676478125e-5,'fl oz (US)':2.95735295625e-5,
        'cup (US)':2.365882365e-4,'pt (US)':4.73176473e-4,'qt (US)':9.46352946e-4,'gal (US)':3.785411784e-3
      }},
      Mass: { base:'kg', units:{
        'mg':1e-6,'g':1e-3,'kg':1,'tonne':1e3,
        'grain':6.479891e-5,'oz':0.028349523125,'lb':0.45359237,'stone':6.35029318,
        'kati (catty)':0.60478982,'tahil':0.03779936375,'picul':60.478982,'carat (metric)':0.0002
      }},
      Time: { base:'s', units:{ 'ms':1e-3,'s':1,'min':60,'h':3600,'day':86400,'week':604800,'year (365d)':31536000 }},
      Speed: { base:'m/s', units:{ 'm/s':1,'km/h':1/3.6,'mph':0.44704,'knot':0.514444,'ft/s':0.3048,'c':299792458 }},
      Acceleration: { base:'m/sÂ²', units:{ 'm/sÂ²':1,'g0':9.80665 }},
      Temperature: { base:'K', units:{ 'Â°C':'C','Â°F':'F','K':'K' }},
      Energy: { base:'J', units:{ 'J':1,'kJ':1e3,'Wh':3600,'kWh':3.6e6,'cal':4.184,'kcal':4184,'eV':1.602176634e-19,'BTU':1055.05585262 }},
      Power: { base:'W', units:{ 'W':1,'kW':1e3,'MW':1e6,'hp (mech)':745.6998715822702 }},
      Pressure: { base:'Pa', units:{ 'Pa':1,'kPa':1e3,'MPa':1e6,'bar':1e5,'atm':101325,'psi':6894.757293168,'mmHg':133.322368,'inHg':3386.389 }},
      Data: { base:'bit', units:{ 'bit':1,'Byte':8,'KB (SI)':8e3,'MB (SI)':8e6,'GB (SI)':8e9,'TB (SI)':8e12,'KiB':8192,'MiB':8388608,'GiB':8589934592 }},
      Angle: { base:'rad', units:{ 'rad':1,'deg':Math.PI/180,'grad':Math.PI/200,'turn':2*Math.PI }},
      Force: { base:'N', units:{ 'N':1,'kN':1e3,'lbf':4.4482216152605,'kgf':9.80665 }},
      Frequency: { base:'Hz', units:{ 'Hz':1,'kHz':1e3,'MHz':1e6,'GHz':1e9 }},
      Density: { base:'kg/mÂ³', units:{ 'kg/mÂ³':1,'g/cmÂ³':1000,'g/mL':1000,'lb/ftÂ³':16.01846337 }}
    };

    const cat = document.getElementById('cat');
    const fromUnit = document.getElementById('fromUnit');
    const toUnit = document.getElementById('toUnit');
    const fromVal = document.getElementById('fromVal');
    const convOut = document.getElementById('convOut');

    function fillCategories(){
      cat.innerHTML = Object.keys(UNITS).map(k=>`<option>${k}</option>`).join('');
      cat.value = 'Length'; fillUnits('Length');
    }
    function fillUnits(kind){
      const u = UNITS[kind].units; const opts = Object.keys(u).map(k=>`<option>${k}</option>`).join('');
      fromUnit.innerHTML = opts; toUnit.innerHTML = opts; fromUnit.selectedIndex=0; toUnit.selectedIndex=1;
    }
    cat.addEventListener('change', ()=>fillUnits(cat.value));

    document.getElementById('doConv').addEventListener('click', ()=>{
      const kind = cat.value; const x = parseFloat(fromVal.value);
      if(!isFinite(x)){ convOut.textContent='Enter a valid number.'; return; }
      if(kind==='Temperature'){
        const f = fromUnit.value, t = toUnit.value; let K;
        if(f==='K') K=x; else if(f==='Â°C') K=x+273.15; else if(f==='Â°F') K=(x-32)*5/9+273.15;
        let out = K; if(t==='K') out=K; else if(t==='Â°C') out=K-273.15; else if(t==='Â°F') out=(K-273.15)*9/5+32;
        convOut.textContent = `${x} ${f} = ${out} ${t}`; return;
      }
      const base = UNITS[kind].units[fromUnit.value];
      const to = UNITS[kind].units[toUnit.value];
      const y = x * (base / to);
      convOut.textContent = `${x} ${fromUnit.value} = ${y} ${toUnit.value}`;
    });

    fillCategories();

    // ===== Mass-Volume by density =====
    const mvDirection = document.getElementById('mvDirection');
    const mvFrom = document.getElementById('mvFrom');
    const mvTo = document.getElementById('mvTo');
    const mvValue = document.getElementById('mvValue');
    const mvDensity = document.getElementById('mvDensity');
    const mvDensityUnit = document.getElementById('mvDensityUnit');
    const mvOut = document.getElementById('mvOut');

    const MASS_UNITS = { 'g':1e-3,'kg':1,'lb':0.45359237,'kati (catty)':0.60478982,'tahil':0.03779936375,'picul':60.478982 };
    const VOL_UNITS = { 'mL':1e-6,'L':1e-3,'mÂ³':1,'cup (US)':2.365882365e-4,'pt (US)':4.73176473e-4,'qt (US)':9.46352946e-4,'gal (US)':3.785411784e-3 };

    function fillMV(){
      mvFrom.innerHTML = Object.keys(MASS_UNITS).map(u=>`<option>${u}</option>`).join('');
      mvTo.innerHTML = Object.keys(VOL_UNITS).map(u=>`<option>${u}</option>`).join('');
      mvFrom.value='kg'; mvTo.value='L';
    }

    function densToSI(val, unit){
      if(unit==='kg/mÂ³') return val;
      if(unit==='g/cmÂ³' || unit==='g/mL') return val*1000; // 1 g/cmÂ³ = 1000 kg/mÂ³
      return val;
    }

    document.getElementById('doMV').addEventListener('click',()=>{
      const dir = mvDirection.value; const v = parseFloat(mvValue.value); if(!isFinite(v)){ mvOut.textContent='Enter a number.'; return; }
      const rho = densToSI(parseFloat(mvDensity.value), mvDensityUnit.value);
      if(!isFinite(rho) || rho<=0){ mvOut.textContent='Enter a valid density.'; return; }
      if(dir==='m2v'){
        // mass â†’ volume
        const mSI = v * MASS_UNITS[mvFrom.value]; // kg
        const volSI = mSI / rho; // mÂ³
        const volOut = volSI / VOL_UNITS[mvTo.value];
        mvOut.textContent = `${v} ${mvFrom.value} at ${mvDensity.value} ${mvDensityUnit.value} = ${volOut} ${mvTo.value}`;
      }else{
        // volume â†’ mass
        const volSI = v * VOL_UNITS[mvFrom.value]; // mÂ³ (when from is actually volume picker; reuse names)
        const mSI = volSI * rho; // kg
        const mOut = mSI / MASS_UNITS[mvTo.value];
        mvOut.textContent = `${v} ${mvFrom.value} at ${mvDensity.value} ${mvDensityUnit.value} = ${mOut} ${mvTo.value}`;
      }
    });

    document.querySelectorAll('#panel-massvol .tab[data-d]').forEach(b=>{
      b.addEventListener('click',()=>{ mvDensity.value = b.dataset.d; });
    });

    function setMVDirection(){
      if(mvDirection.value==='m2v'){
        mvFrom.innerHTML = Object.keys(MASS_UNITS).map(u=>`<option>${u}</option>`).join('');
        mvTo.innerHTML = Object.keys(VOL_UNITS).map(u=>`<option>${u}</option>`).join('');
        mvFrom.value='kg'; mvTo.value='L';
      } else {
        mvFrom.innerHTML = Object.keys(VOL_UNITS).map(u=>`<option>${u}</option>`).join('');
        mvTo.innerHTML = Object.keys(MASS_UNITS).map(u=>`<option>${u}</option>`).join('');
        mvFrom.value='L'; mvTo.value='kg';
      }
    }
    mvDirection.addEventListener('change', setMVDirection);
    fillMV(); setMVDirection();

  });
  </script>
</body>
</html>
